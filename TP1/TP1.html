<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="author" content="Mickael Lanier" />
		<meta name="description" content="Un TD" />
		<meta name="keywords" content="dut,td" />
		<title>TP 1</title>
	</head>
	<body>
		<h1 id="titre" class="firstOfLast">Micka</h1>

		<h2>H2#1</h2>
		<h2 class="firstOfLast">H2#2</h2>

		<h3 class="firstOfLast">H3#1</h3>
		<h3>H3#2</h3>
		<h3>H3#3</h3>

		<div>
			<p>J'ai vraiment faim</p>
		</div>
		<div>
			<p>On mange quand?</p>
		</div>

		<div id="date_modif"></div>

		<p id="nbJours">Il reste xxx jours avant le 19 juillet 2015</p>

		<p id="horloge"></p>

		<div id="grafHorloge">
		</div>

		<script>
			document.querySelector('body').onload = init;

			const pageTitle = document.getElementsByTagName('title')[0];
			const name = 'Mickaël Lanier';
			const horlogeNode = document.getElementById("horloge");

			function hour() {
				const date = new Date();
				return date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();
			}

			function init() {
				defTitre1();
				datemodif();
				horlogeNode.innerHTML = hour();
			}

			function defTitre1() {
				const title = document.getElementById('titre');
				pageTitle.innerHTML = title.innerHTML;
			}

			function defTitre2() {
				const title = document.getElementsByTagName('h2')[0].innerHTML;
				pageTitle.innerHTML = title;
			}

			function defTitre3() {
				const tags = document.getElementsByTagName('h2');
				const title = tags.length >= 2 ? tags[1].innerHTML : name;

				pageTitle.innerHTML = title;
			}

			function defTitre4() {
			var firstOrLast = document.getElementsByClassName("firstOrLast");
			if (firstOrLast && firstOrLast.length > 0)
				document.title = firstOrLast.length % 2 == 0 ? firstOrLast.item(0).innerText : firstOrLast.item(firstOrLast.length - 1).innerText;
			else
        		document.title = "Mickaël Lanier"
			}

			function inverseTexte() {
				const tags = document.getElementsByTagName('p');
				const temp = tags[0].innerHTML;
				tags[0].innerHTML = tags[1].innerHTML;
				tags[1].innerHTML = temp;
			}

			function datemodif() {
				const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
				const months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];

				const authors = document.querySelectorAll('meta[name=author]');

				if (authors.length === 0) {
					return;
				}
				const author = authors[0];

				const text = 'Dernière modification le {date} par ' + author.content;

				const curDate = new Date();
				let dateStr = days[curDate.getDay()]
					+ ' ' + curDate.getDate()
					+ ' ' + months[curDate.getMonth()]
					+ ' ' + curDate.getFullYear();

				const res = text.replace('{date}', dateStr);
				document.getElementById('date_modif').innerHTML = res;
			}

			document.getElementById("nbJours").addEventListener('click', function (ev) {
				const target = ev.target;
				const currDate = new Date();
				const oldDate = new Date('2015-07-19');

				const diff = oldDate.getTime() - currDate.getTime();
				target.innerHTML = target.innerHTML.replace("xxx", Math.round(diff / 1000 / 3600));
			});

			function majHorloge1() {
				horlogeNode.innerHTML = hour();
			}
			setInterval(majHorloge1, 200);

			function majHorloge2() {
				horlogeNode.innerHTML = hour();
			}
			setTimeout(majHorloge2, 1000);

			function majGrafH() {
				const node = document.getElementById("grafHorloge");
				let currHour = hour();
				const chars = currHour.split('');

				node.innerHTML = '';
				for (const c in chars) {
					if (chars[c] === ':') {
						node.innerHTML += ':';
					} else node.innerHTML = node.innerHTML
						.concat('<img src="images/' + chars[c] + '.gif" />');
				}
			}
			
addEventListener("load", defTitre1);
addEventListener("load", defTitre2);
addEventListener("load", defTitre3);
addEventListener("load", defTitre4);
addEventListener("load", inverseTexte);
		</script>
	</body>
</html>